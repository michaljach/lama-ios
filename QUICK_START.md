# Quick Start: Google AI Integration\n\n## For Users\n\n### Get Your API Key\n1. Visit [https://aistudio.google.com/apikey](https://aistudio.google.com/apikey)\n2. Sign in with your Google account\n3. Click \"Create API Key\"\n4. Copy the generated key\n\n### Configure the App\n1. Open iA app\n2. Tap Settings (⚙️)\n3. Select \"Google AI (Gemini)\" from API Provider dropdown\n4. Paste your API key in the Google AI section\n5. Select a Gemini model (e.g., gemini-2.5-flash)\n6. Start chatting!\n\n### Available Models\n- **gemini-2.5-flash** - Fast, great for quick responses\n- **gemini-2.5-pro** - Advanced reasoning and analysis\n- **gemini-3-flash** - Latest with frontier-class performance\n- **gemini-3-pro** - Most intelligent model\n\n---\n\n## For Developers\n\n### Project Structure\n\n**New Services:**\n`\niA/Sources/Services/\n├── ChatService.swift          # Unified provider interface\n└── GoogleAIService.swift      # Google AI specific implementation\n`\n\n**Updated Features:**\n`\niA/Sources/Features/SettingsFeature/\n├── SettingsReducer.swift      # Added provider selection & API key\n└── SettingsView.swift         # Added provider UI & key input\n`\n\n### Using ChatService in Code\n\n`swift\n// In your reducer\n@Dependency(\\.chatService) var chatService\n\n// Send a message\nlet response = try await chatService.sendMessage(\n    messages,           // [ChatMessage]\n    model,              // String (e.g., \"gemini-2.5-flash\")\n    temperature,        // Double (0.0 - 2.0)\n    maxTokens,          // Int\n    .googleAI           // ChatProvider\n)\n`\n\n### Key Components\n\n#### 1. ChatMessage\nRepresents a single message in the conversation:\n`swift\nstruct ChatMessage {\n    let role: String  // \"user\" or \"assistant\"\n    let content: String\n}\n`\n\n#### 2. ChatProvider\nEnum to select between providers:\n`swift\nenum ChatProvider {\n    case groq\n    case googleAI\n}\n`\n\n#### 3. ChatError\nError types for error handling:\n`swift\nenum ChatError: LocalizedError {\n    case noAPIKey\n    case networkError(String)\n    case invalidResponse\n    case apiError(String)\n}\n`\n\n### Settings State\n\nNew properties in `Settings.State`:\n`swift\nvar apiProvider: APIProvider = .groq  // Select provider\nvar googleAIAPIKey: String = \"\"       // Store API key\n`\n\nAPI Key is automatically stored in `UserDefaults`:\n`swift\n// Stored with key \"googleAIAPIKey\"\nUserDefaults.standard.string(forKey: \"googleAIAPIKey\")\n`\n\n### Error Handling\n\n`swift\ndo {\n    let response = try await chatService.sendMessage(\n        messages, model, temperature, maxTokens, .googleAI\n    )\n    // Use response\n} catch ChatError.noAPIKey {\n    print(\"Configure API key in Settings\")\n} catch ChatError.networkError(let error) {\n    print(\"Network issue: \\(error)\")\n} catch ChatError.invalidResponse {\n    print(\"Invalid response from API\")\n} catch ChatError.apiError(let error) {\n    print(\"API error: \\(error)\")\n}\n`\n\n### Provider Configuration\n\nGet current provider:\n`swift\nlet providerRaw = UserDefaults.standard.string(forKey: \"apiProvider\") ?? \"groq\"\nlet isGoogleAI = providerRaw == \"googleai\"\n`\n\nSwitch provider in settings:\n`swift\ncase .apiProviderChanged(let provider):\n    state.apiProvider = provider\n    UserDefaults.standard.set(provider.rawValue, forKey: \"apiProvider\")\n`\n\n### Testing\n\n#### Mock Data\n`swift\n// Use test value for previews and tests\nStore(initialState: State()) {\n    Reducer()\n        .dependency(\\.chatService, .testValue)\n}\n`\n\n#### Custom Mock\n`swift\n.dependency(\\.chatService, ChatService(\n    sendMessage: { _, _, _, _, _ in\n        \"Mock response for testing\"\n    }\n))\n`\n\n### Common Patterns\n\n#### Sending a Simple Message\n`swift\nlet messages = [ChatMessage(role: \"user\", content: \"Hello!\")]\nlet response = try await chatService.sendMessage(\n    messages,\n    \"gemini-2.5-flash\",\n    0.7,\n    1024,\n    .googleAI\n)\nprint(response)\n`\n\n#### With Error Recovery\n`swift\nvar response: String?\nvar attempts = 0\nlet maxAttempts = 3\n\nwhile attempts < maxAttempts && response == nil {\n    do {\n        response = try await chatService.sendMessage(\n            messages, model, temp, tokens, .googleAI\n        )\n    } catch {\n        attempts += 1\n        if attempts < maxAttempts {\n            try await Task.sleep(for: .seconds(1))\n        }\n    }\n}\n`\n\n#### Provider Abstraction\n`swift\nfunc getCurrentProvider() -> ChatProvider {\n    let providerRaw = UserDefaults.standard.string(forKey: \"apiProvider\") ?? \"groq\"\n    return providerRaw == \"googleai\" ? .googleAI : .groq\n}\n\nlet provider = getCurrentProvider()\nlet response = try await chatService.sendMessage(\n    messages, model, temperature, maxTokens, provider\n)\n`\n\n### API Endpoints\n\n**Google AI:**\n- Generate: `https://generativelanguage.googleapis.com/v1beta/models/{model}:generateContent?key={API_KEY}`\n- List Models: `https://generativelanguage.googleapis.com/v1beta/models?key={API_KEY}`\n\n**Groq:**\n- Generate: `https://api.groq.com/openai/v1/chat/completions`\n\n### Documentation\n\nFor more detailed information:\n- [GOOGLE_AI_INTEGRATION.md](GOOGLE_AI_INTEGRATION.md) - Complete user guide\n- [INTEGRATION_SUMMARY.md](INTEGRATION_SUMMARY.md) - Technical architecture\n- [GOOGLE_AI_EXAMPLES.md](GOOGLE_AI_EXAMPLES.md) - Advanced code examples\n- [GOOGLE_AI_CHECKLIST.md](GOOGLE_AI_CHECKLIST.md) - Verification checklist\n\n### Troubleshooting\n\n| Issue | Solution |\n|-------|----------|\n| \"No API Key\" error | Paste your key in Settings > Google AI |\n| \"Invalid response\" | Check internet connection, verify API key |\n| App doesn't compile | Ensure all services import ComposableArchitecture |\n| Key not saving | Check UserDefaults permission (iOS settings) |\n| Model not available | Check your Google AI account tier, try different model |\n\n### Security Best Practices\n\n✅ DO:\n- Store API keys in UserDefaults (local only)\n- Use SecureField for API key input\n- Validate API keys before use\n- Handle errors gracefully\n\n❌ DON'T:\n- Hardcode API keys in source code\n- Log or print API keys\n- Share API keys between providers\n- Store keys in app bundle\n\n### Next Steps\n\n1. **Build**: `⌘B` in Xcode\n2. **Run**: `⌘R` to launch the app\n3. **Test**: Get a free API key from https://aistudio.google.com/apikey\n4. **Configure**: Enter key in Settings\n5. **Chat**: Start using Google AI models!\n\n### Support Links\n\n- [Get API Key](https://aistudio.google.com/apikey)\n- [Google AI Docs](https://ai.google.dev/gemini-api/docs)\n- [API Reference](https://ai.google.dev/api)\n- [Pricing](https://ai.google.dev/gemini-api/docs/pricing)\n- [Troubleshooting](https://ai.google.dev/gemini-api/docs/troubleshooting)\n
